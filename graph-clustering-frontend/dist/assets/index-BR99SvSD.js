var I=Object.defineProperty;var $=(s,t,r)=>t in s?I(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r;var N=(s,t,r)=>$(s,typeof t!="symbol"?t+"":t,r);import{r as h,a as P,R as E}from"./vendor-DsceW-4w.js";import{c as R}from"./store-C_C31XNr.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))a(l);new MutationObserver(l=>{for(const n of l)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function r(l){const n={};return l.integrity&&(n.integrity=l.integrity),l.referrerPolicy&&(n.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?n.credentials="include":l.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(l){if(l.ep)return;l.ep=!0;const n=r(l);fetch(l.href,n)}})();var D={exports:{}},C={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var O=h,T=Symbol.for("react.element"),U=Symbol.for("react.fragment"),L=Object.prototype.hasOwnProperty,_=O.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,M={key:!0,ref:!0,__self:!0,__source:!0};function k(s,t,r){var a,l={},n=null,i=null;r!==void 0&&(n=""+r),t.key!==void 0&&(n=""+t.key),t.ref!==void 0&&(i=t.ref);for(a in t)L.call(t,a)&&!M.hasOwnProperty(a)&&(l[a]=t[a]);if(s&&s.defaultProps)for(a in t=s.defaultProps,t)l[a]===void 0&&(l[a]=t[a]);return{$$typeof:T,type:s,key:n,ref:i,props:l,_owner:_.current}}C.Fragment=U;C.jsx=k;C.jsxs=k;D.exports=C;var e=D.exports,S={},F=P;S.createRoot=F.createRoot,S.hydrateRoot=F.hydrateRoot;const b=R(s=>({datasets:[],currentDataset:null,experiments:[],currentViz:"timeline-hierarchy",addDataset:t=>s(r=>({datasets:[...r.datasets,t],currentDataset:t})),setCurrentDataset:t=>s({currentDataset:t}),removeDataset:t=>s(r=>({datasets:r.datasets.filter(a=>a.id!==t),experiments:r.experiments.filter(a=>a.datasetId!==t),currentDataset:r.currentDataset?.id===t?null:r.currentDataset})),addExperiment:t=>s(r=>({experiments:[...r.experiments,t]})),updateExperiment:(t,r)=>s(a=>({experiments:a.experiments.map(l=>l.id===t?{...l,...r}:l)})),removeExperiment:t=>s(r=>({experiments:r.experiments.filter(a=>a.id!==t)})),setCurrentViz:t=>s({currentViz:t}),reset:()=>s({datasets:[],currentDataset:null,experiments:[],currentViz:"timeline-hierarchy"})}));class z{constructor(t="http://localhost:8080/api/v1"){N(this,"baseUrl");this.baseUrl=t}async uploadDataset(t,r){const a=new FormData;a.append("name",t),a.append("graphFile",r.graphFile),a.append("propertiesFile",r.propertiesFile),a.append("pathFile",r.pathFile);const l=await fetch(`${this.baseUrl}/datasets`,{method:"POST",body:a});if(!l.ok){const n=await l.text();throw new Error(`Upload failed: ${l.status} ${n}`)}return l.json()}async startClustering(t,r,a){const l=await fetch(`${this.baseUrl}/datasets/${t}/clustering`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({algorithm:r,parameters:a})});if(!l.ok){const n=await l.text();throw new Error(`Clustering failed: ${l.status} ${n}`)}return l.json()}async getJobStatus(t,r){const a=await fetch(`${this.baseUrl}/datasets/${t}/clustering/${r}`);if(!a.ok)throw new Error(`Failed to get job status: ${a.statusText}`);return a.json()}async getHierarchy(t,r){const a=await fetch(`${this.baseUrl}/datasets/${t}/hierarchy?jobId=${r}`);if(!a.ok)throw new Error(`Failed to get hierarchy: ${a.statusText}`);return a.json()}}const w=new z,y=({children:s,onClick:t,disabled:r=!1,variant:a="primary",size:l="md",className:n=""})=>{const i={primary:"bg-blue-600 text-white hover:bg-blue-700",secondary:"bg-gray-200 text-gray-900 hover:bg-gray-300",danger:"bg-red-600 text-white hover:bg-red-700",success:"bg-green-600 text-white hover:bg-green-700"},o={sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"},u=["rounded-md font-medium transition-colors duration-200",i[a],o[l],r?"opacity-50 cursor-not-allowed":"",n].filter(Boolean).join(" ");return e.jsx("button",{className:u,onClick:t,disabled:r,children:s})},j=({children:s,className:t="",onClick:r})=>{const a=["bg-white rounded-lg shadow border border-gray-200 p-4",r?"cursor-pointer hover:shadow-md transition-all duration-200":"",t].filter(Boolean).join(" ");return e.jsx("div",{className:a,onClick:r,children:s})},A=({message:s="Loading...",progress:t})=>e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-3",children:[e.jsx("div",{className:"animate-spin rounded-full border-2 border-gray-300 border-t-blue-600 w-6 h-6"}),s&&e.jsx("p",{className:"text-sm text-gray-600 text-center",children:s}),t!==void 0&&e.jsxs("div",{className:"w-full max-w-xs",children:[e.jsx("div",{className:"bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${Math.min(100,Math.max(0,t))}%`}})}),e.jsxs("div",{className:"text-xs text-gray-500 text-center mt-1",children:[Math.round(t||0),"%"]})]})]}),G=({onComplete:s,onCancel:t})=>{const[r,a]=h.useState(""),[l,n]=h.useState({}),[i,o]=h.useState(!1),[u,d]=h.useState(null),{addDataset:p}=b(),c=x=>g=>{const f=g.target.files?.[0];f&&(n(v=>({...v,[x]:f})),d(null))},m=async()=>{if(!r.trim()||!l.graphFile||!l.propertiesFile||!l.pathFile){d("Please provide all required fields and files");return}o(!0),d(null);try{const g={id:(await w.uploadDataset(r.trim(),{graphFile:l.graphFile,propertiesFile:l.propertiesFile,pathFile:l.pathFile})).data.datasetId,name:r.trim(),uploadedAt:new Date().toISOString()};p(g),s()}catch(x){d(x instanceof Error?x.message:"Upload failed. Please try again.")}finally{o(!1)}};return i?e.jsx(j,{className:"max-w-md mx-auto",children:e.jsx(A,{message:"Uploading dataset..."})}):e.jsx(j,{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Upload Dataset"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Upload your graph files to start clustering analysis"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Dataset Name"}),e.jsx("input",{type:"text",value:r,onChange:x=>a(x.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"My Graph Dataset"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[{key:"graphFile",label:"Graph File",desc:"Format: source target [weight]"},{key:"propertiesFile",label:"Properties File",desc:"Format: nodeId typeId"},{key:"pathFile",label:"Path File",desc:"Format: typeId (one per line)"}].map(({key:x,label:g,desc:f})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:g}),e.jsx("input",{type:"file",onChange:c(x),className:"w-full text-sm file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100",accept:".txt,.csv"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:f})]},x))})]}),u&&e.jsx("div",{className:"p-3 bg-red-100 border border-red-400 text-red-700 rounded-md",children:u}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[t&&e.jsx(y,{variant:"secondary",onClick:t,children:"Cancel"}),e.jsx(y,{onClick:m,disabled:!r.trim()||!l.graphFile||!l.propertiesFile||!l.pathFile,children:"Upload Dataset"})]})]})})},B=()=>{const{currentDataset:s,addExperiment:t}=b(),[r,a]=h.useState("louvain"),[l,n]=h.useState({maxLevels:5,maxIterations:100,minModularityGain:1e-6}),[i,o]=h.useState(!1),[u,d]=h.useState(null),p=async()=>{if(!s)return;const c={id:`exp_${Date.now()}`,datasetId:s.id,algorithm:r,parameters:l,status:"configuring",createdAt:new Date().toISOString()};t(c),o(!0),d(null);try{const m=await w.startClustering(s.id,r,l);b.getState().updateExperiment(c.id,{jobId:m.data.jobId,status:"running"})}catch(m){b.getState().updateExperiment(c.id,{status:"failed",error:m instanceof Error?m.message:"Failed to start clustering"}),d(m instanceof Error?m.message:"Failed to start experiment")}finally{o(!1)}};return s?e.jsx(j,{className:"border-l-4 border-blue-500",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"New Experiment"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Configure clustering parameters for ",s.name]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Algorithm"}),e.jsxs("select",{value:r,onChange:c=>a(c.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"louvain",children:"Louvain"}),e.jsx("option",{value:"scar",children:"SCAR"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Max Levels"}),e.jsx("input",{type:"number",value:l.maxLevels,onChange:c=>n(m=>({...m,maxLevels:parseInt(c.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-md",min:"1",max:"20"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Max Iterations"}),e.jsx("input",{type:"number",value:l.maxIterations,onChange:c=>n(m=>({...m,maxIterations:parseInt(c.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-md",min:"10",max:"1000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Min Modularity Gain"}),e.jsx("input",{type:"number",value:l.minModularityGain,onChange:c=>n(m=>({...m,minModularityGain:parseFloat(c.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-md",step:"0.000001",min:"0"})]})]})]}),u&&e.jsx("div",{className:"p-3 bg-red-100 border border-red-400 text-red-700 rounded-md",children:u}),e.jsx(y,{variant:"success",onClick:p,disabled:i||!s,className:"w-full",children:i?"Starting...":"Start Experiment"})]})}):e.jsx(j,{className:"border-l-4 border-gray-400",children:e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"Please upload a dataset to create experiments"})})})},V=(s,t,r)=>{E.useEffect(()=>{if(!r)return;const a=async()=>{try{await s()&&setTimeout(a,t)}catch(l){console.error("Polling error:",l)}};a()},[s,t,r])},H=({nodes:s,coordinates:t,width:r=120,height:a=80})=>{const n=r/2,i=a/2,o=s.filter(u=>t[u]);return o.length===0?e.jsx("div",{className:"flex items-center justify-center bg-gray-50 border rounded text-xs text-gray-500",style:{width:r,height:a},children:"No coordinates"}):e.jsx("svg",{width:r,height:a,className:"border rounded bg-gray-50",children:o.map(u=>{const d=t[u],p=Math.max(2,d.radius*.3),c=u.startsWith("c0_")?"#ef4444":"#06b6d4";return e.jsx("circle",{cx:n+d.x*.4,cy:i+d.y*.4,r:p,fill:c,stroke:"#fff",strokeWidth:"1",children:e.jsx("title",{children:u})},u)})})},J=({experiment:s})=>{const{updateExperiment:t}=b(),[r,a]=h.useState([]),l=E.useCallback(async()=>{if(!s.jobId||s.status!=="running")return!1;try{const o=(await w.getJobStatus(s.datasetId,s.jobId)).data;if(t(s.id,{status:o.status,progress:o.progress,error:o.error}),o.status==="completed"){const d=(await w.getHierarchy(s.datasetId,s.jobId)).data.hierarchy;if(t(s.id,{result:d}),d.levels.length>0){const p=[];for(let c=d.levels.length-1;c>=0;c--){const m=d.levels[c],x=Object.entries(m.communities);if(x.length>0){const g=x.reduce((f,v)=>v[1].length>f[1].length?v:f);p.push(g[0])}}a(p)}return!1}return o.status==="running"}catch(i){return t(s.id,{status:"failed",error:i instanceof Error?i.message:"Job polling failed"}),!1}},[s.id,s.jobId,s.datasetId,s.status,t]);V(l,2e3,s.status==="running");const n=()=>Object.entries(s.parameters).map(([i,o])=>`${i}=${o}`).join(", ");return e.jsx("div",{className:"min-w-80",children:e.jsx(j,{className:"h-full border-2 border-transparent hover:border-blue-300 transition-all",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("h3",{className:"font-semibold",children:["Experiment ",s.id.slice(-4)]}),e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded font-medium",children:s.algorithm})]}),e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:n()}),s.result&&e.jsxs("div",{className:"flex flex-col gap-1 text-xs text-gray-700",children:[e.jsxs("span",{children:["Modularity: ",s.result.modularity.toFixed(3)]}),e.jsxs("span",{children:["Levels: ",s.result.levels.length]}),s.result.processingTimeMS&&e.jsxs("span",{children:["Time: ",(s.result.processingTimeMS/1e3).toFixed(1),"s"]})]})]}),s.status==="running"&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm text-blue-600",children:"Running..."})]}),s.progress&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${s.progress.percentage}%`}})}),e.jsx("p",{className:"text-xs text-gray-600",children:s.progress.message})]})]}),s.status==="failed"&&e.jsxs("div",{className:"mb-4 p-3 bg-red-100 border border-red-300 rounded text-red-700 text-sm",children:["Error: ",s.error]}),s.result&&r.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Hierarchy Path"}),r.map((i,o)=>{const u=s.result.levels.length-1-o,d=s.result.levels[u],p=d.communities[i]||[];return e.jsxs("div",{className:"bg-white border-l-4 border-blue-500 rounded-lg p-3 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("h5",{className:"font-semibold text-gray-700",children:["Level ",d.level]}),e.jsxs("span",{className:"text-sm text-gray-500",children:[Object.keys(d.communities).length," communities"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-blue-600",children:i}),e.jsxs("span",{className:"text-xs text-gray-500",children:[p.length," nodes"]})]}),e.jsx(H,{nodes:p,coordinates:s.result.coordinates,width:100,height:60})]})]},`${u}-${i}`)})]})]})})})},W=()=>{const{experiments:s,currentDataset:t}=b();if(!t)return e.jsx("div",{className:"flex items-center justify-center h-64 text-gray-500",children:"Please upload a dataset first"});const r=s.filter(a=>a.datasetId===t.id);return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"border-b border-gray-200 p-4 bg-white",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Timeline Hierarchy"}),e.jsxs("p",{className:"text-gray-600",children:["Dataset: ",t.name]})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsxs("div",{className:"flex gap-4 p-4 overflow-x-auto h-full",children:[r.map(a=>e.jsx(J,{experiment:a},a.id)),r.length===0&&e.jsx("div",{className:"flex items-center justify-center w-full text-gray-500",children:"No experiments yet. Create one using the controls above."})]})})]})},Y=()=>{const{currentDataset:s}=b(),[t,r]=h.useState(!1);return e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx("header",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Graph Clustering Visualization"}),s&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Current: ",s.name]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(y,{onClick:()=>r(!0),children:"Upload Dataset"})})]})})}),e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[t&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Upload New Dataset"}),e.jsx("button",{onClick:()=>r(!1),className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),e.jsx(G,{onComplete:()=>r(!1)})]})})}),s&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(B,{}),e.jsx("div",{className:"bg-white rounded-lg shadow h-[600px]",children:e.jsx(W,{})})]}),!s&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Welcome to Graph Clustering Visualization"}),e.jsx("p",{className:"text-gray-600 mb-8",children:"Upload your graph dataset to get started with clustering analysis"}),e.jsx(y,{onClick:()=>r(!0),size:"lg",children:"Upload Your First Dataset"})]})]})]})};class q extends h.Component{constructor(r){super(r);N(this,"handleReset",()=>{this.setState({hasError:!1,error:void 0,errorInfo:void 0})});N(this,"handleReload",()=>{window.location.reload()});this.state={hasError:!1}}static getDerivedStateFromError(r){return{hasError:!0,error:r}}componentDidCatch(r,a){console.error("ErrorBoundary caught an error:",r,a),this.setState({error:r,errorInfo:a})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center p-4",children:e.jsx("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-500 mb-4",children:e.jsx("svg",{className:"mx-auto h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.232 15.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Oops! Something went wrong"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"The visualization encountered an unexpected error. This might be due to invalid data or a network issue."}),!1,e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:this.handleReset,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Try Again"}),e.jsx("button",{onClick:this.handleReload,className:"w-full px-4 py-2 bg-gray-200 text-gray-900 rounded-md hover:bg-gray-300 transition-colors",children:"Reload Page"})]}),e.jsxs("div",{className:"mt-6 text-sm text-gray-500",children:[e.jsx("p",{children:"If this problem persists, please check:"}),e.jsxs("ul",{className:"mt-2 text-left space-y-1",children:[e.jsx("li",{children:"• Your internet connection"}),e.jsx("li",{children:"• That the backend server is running"}),e.jsx("li",{children:"• That your data files are valid"})]})]})]})})}):this.props.children}}const K=S.createRoot(document.getElementById("root"));K.render(e.jsx(E.StrictMode,{children:e.jsx(q,{children:e.jsx(Y,{})})}));
//# sourceMappingURL=index-BR99SvSD.js.map
